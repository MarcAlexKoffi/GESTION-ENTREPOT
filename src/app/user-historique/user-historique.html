<body>
  <div class="page-root">
    <main class="page-main">
      <div class="page-container">
        <!-- HEADER -->
        <header class="page-header">
          <div class="page-title-block">
            <p class="page-title">Historique des passages</p>
            <p class="page-subtitle">
              Consultez et filtrez l'historique de tous les passages de camions.
            </p>
          </div>
          <button type="button" class="primary-chip-button" (click)="exportCsv()">
            <span class="material-symbols-outlined">download</span>
            <span>Exporter</span>
          </button>
        </header>
        <!-- FILTERS -->
        <section class="filters-section" aria-label="Filtres d'historique">
          <div class="history-toolbar">
            <!-- Recherche -->
            <div class="history-search">
              <span class="material-symbols-outlined">search</span>
              <input
                type="text"
                placeholder="Rechercher par immatriculation ou transporteur..."
                [(ngModel)]="searchTerm"
                (input)="applyFilters()"
              />
            </div>

            <!-- Filtres -->
            <div class="history-filters">
              <div class="history-filter">
                <label>Période</label>
                <select [(ngModel)]="selectedPeriod" (change)="applyFilters()">
                  <option>Toutes</option>
                  <option>Aujourd’hui</option>
                  <option>7 derniers jours</option>
                  <option>30 derniers jours</option>
                </select>
              </div>

              <div class="history-filter">
                <label>Statut</label>
                <select [(ngModel)]="selectedStatus" (change)="applyFilters()">
                  <option>Tous</option>
                  <option>En attente</option>
                  <option>En cours de déchargement</option>
                  <option>Déchargé</option>
                  <option>Annulé</option>
                </select>
              </div>
            </div>
          </div>
        </section>

        <!-- TABLE -->
        <section class="table-card" aria-label="Tableau des passages">
          <div class="table-scroll">
            <table>
              <thead>
                <tr>
                  <th>Entrepôt</th>
                  <th>Immatriculation</th>
                  <th>Transporteur</th>
                  <th>KOR (qualité)</th>
                  <th>Heure d'enrégistrementy</th>
                  <th>Début déchargement</th>
                  <th>Fin déchargement</th>
                  <th>Statut</th>
                  <th class="action-cell">Action</th>
                </tr>
              </thead>
              <tbody>
                <!-- Si aucune ligne -->

                <tr *ngIf="filteredRows.length === 0">
                  <td colspan="9" class="cell-muted">
                    Aucun passage ne correspond à vos filtres pour le moment.
                  </td>
                </tr>

                <!-- Lignes d'historique -->
                <tr *ngFor="let row of filteredRows">
                  <td class="cell-muted">{{ row.entrepotName }}</td>
                  <td class="cell-main">{{ row.immatriculation }}</td>
                  <td class="cell-muted">{{ row.transporteur }}</td>
                  <td class="cell-muted">{{ row.kor || '-' }}</td>
                  <td class="cell-muted">{{ row.heureArrivee }}</td>
                  <td class="cell-muted">{{ row.debutDechargement }}</td>
                  <td class="cell-muted">{{ row.finDechargement }}</td>
                  <td>
                    <span [ngClass]="getStatusCssClass(row.statut)">
                      {{ row.statut }}
                    </span>
                  </td>
                  <td class="action-cell">
                    <button type="button" class="icon-ghost-button">
                      <span class="material-symbols-outlined">visibility</span>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
      </div>
    </main>
  </div>
</body>
