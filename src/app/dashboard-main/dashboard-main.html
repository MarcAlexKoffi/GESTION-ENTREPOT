<!-- Heading -->
<div class="pageMain">
  <div class="page-heading">
    <div class="page-title-block">
      <p class="page-title">Vue d'ensemble des entrepôts</p>
      <p class="page-subtitle">Bonjour, Marc. Bienvenue sur votre tableau de bord.</p>
    </div>

    <button class="primary-button" type="button" (click)="openWarehouseModal()">
      <span class="material-symbols-outlined">add</span>
      <span>Nouvel enregistrement</span>
    </button>
  </div>

  <!-- Filters -->
  <div class="filter-row">
    <button class="filter-chip" type="button">
      <span>Filtrer par région</span>
      <span class="material-symbols-outlined">expand_more</span>
    </button>
    <button class="filter-chip" type="button">
      <span>Filtrer par site</span>
      <span class="material-symbols-outlined">expand_more</span>
    </button>
  </div>

  <!-- Warehouses Grid -->
  <div class="warehouse-grid">
    <article *ngFor="let card of cards" class="warehouse-card" (click)="handleContainerClick(card)">
      <div class="warehouse-card-header">
        <!-- Bouton menu : -->
        <button
          class="Warehouse-card-menu-button"
          type="button"
          (click)="openActionsMenu(card, $event)"
        >
          <span class="material-symbols-outlined">more_vert</span>
        </button>
        <!-- Menu déroulant -->
        <div
          class="warehouse-card-menu"
          *ngIf="actionsMenuWarehouseId === card.id"
          (click)="$event.stopPropagation()"
        >
          <button class="" type="button" (click)="onEditWarehouse(card)">Modifier</button>
          <button class="" type="button" (click)="onDeleteWarehouse(card)">Supprimer</button>
        </div>
      </div>
      <div
        class="warehouse-image"
        [style.background-image]="
          'url(' + (card.imageUrl || 'assets/placeholder-warehouse.png') + ')'
        "
      ></div>

      <div>
        <div style="display: flex; justify-content: space-between; align-items: flex-start">
          <div>
            <p class="warehouse-name">{{ card.name }}</p>
            <p class="warehouse-location">{{ card.location }}</p>
          </div>
          <div *ngIf="card.unreadCount > 0" class="notification-badge" title="Nouvelles actions">
            {{ card.unreadCount }}
          </div>
        </div>

        <div class="warehouse-stats">
          <p>
            En attente: <span>{{ card.pending }}</span>
          </p>
          <p>
            En cours: <span>{{ card.active }}</span>
          </p>
          <p>
            Déchargés: <span>{{ card.discharged }}</span>
          </p>
        </div>
      </div>
    </article>
  </div>

  <!-- Chart -->
  <section class="chart-card">
    <h3 class="chart-title">Volume de camions sur les 7 derniers jours</h3>
    <div class="chart-bars">
      <div class="chart-day">
        <p>Lun</p>
        <div class="chart-bar" style="height: 60%"></div>
      </div>
      <div class="chart-day">
        <p>Mar</p>
        <div class="chart-bar" style="height: 75%"></div>
      </div>
      <div class="chart-day">
        <p>Mer</p>
        <div class="chart-bar" style="height: 50%"></div>
      </div>
      <div class="chart-day">
        <p>Jeu</p>
        <div class="chart-bar" style="height: 85%"></div>
      </div>
      <div class="chart-day">
        <p>Ven</p>
        <div class="chart-bar" style="height: 95%"></div>
      </div>
      <div class="chart-day">
        <p>Sam</p>
        <div class="chart-bar" style="height: 40%"></div>
      </div>
      <div class="chart-day">
        <p>Dim</p>
        <div class="chart-bar" style="height: 20%"></div>
      </div>
    </div>
  </section>
  <!-- MODALE : Créer un nouvel entrepôt -->
  <div class="warehouse-modal" *ngIf="showWarehouseModal">
    <!-- Fond gris transparent -->
    <div class="warehouse-modal__backdrop" (click)="closeWarehouseModal()"></div>

    <!-- Panneau central -->
    <div class="warehouse-modal__panel">
      <!-- En-tête -->
      <div class="warehouse-modal__header">
        <h2 class="warehouse-modal__title">
          {{ editingWarehouseId ? 'Modifier l’entrepôt' : 'Nouvel entrepôt' }}
        </h2>
        <button
          type="button"
          class="warehouse-modal__close"
          aria-label="Fermer"
          (click)="closeWarehouseModal()"
        >
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>

      <!-- Corps de la modale -->
      <div class="warehouse-modal__body">
        <p class="warehouse-modal__intro">
          {{
            editingWarehouseId
              ? 'Modifiez les informations de l’entrepôt sélectionné.'
              : 'Renseignez les informations ci-dessous pour créer un nouvel entrepôt.'
          }}
        </p>

        <!-- Nom -->
        <div class="warehouse-field">
          <label class="warehouse-label" for="wh-name"> Nom de l’entrepôt </label>
          <input
            id="wh-name"
            type="text"
            class="warehouse-input"
            placeholder="Ex : Entrepôt Paris Nord"
            [(ngModel)]="newWarehouse.name"
          />
        </div>

        <!-- Localisation -->
        <div class="warehouse-field">
          <label class="warehouse-label" for="wh-location"> Localisation </label>
          <input
            id="wh-location"
            type="text"
            class="warehouse-input"
            placeholder="Ex : Gonesse, Île-de-France"
            [(ngModel)]="newWarehouse.location"
          />
        </div>

        <!-- Image (URL) -->
        <div class="warehouse-field">
          <label class="warehouse-label"> Image de couverture </label>

          <input
            type="file"
            accept="image/*"
            class="warehouse-input"
            (change)="onImageSelected($event)"
          />

          <p class="warehouse-help">Formats acceptés : JPG, PNG.</p>

          <!-- PREVIEW IMAGE -->
          <div
            *ngIf="imagePreview"
            class="warehouse-image-preview"
            [style.backgroundImage]="'url(' + imagePreview + ')'"
          ></div>
        </div>

        <!-- Statistiques de départ (optionnel) -->
      </div>

      <!-- Pied de la modale -->
      <div class="warehouse-modal__footer">
        <button
          type="button"
          class="warehouse-button warehouse-button--ghost"
          (click)="closeWarehouseModal()"
        >
          Annuler
        </button>

        <button
          class="warehouse-button warehouse-button--primary"
          (click)="saveWarehouse()"
          [disabled]="isLoading"
        >
          <span *ngIf="isLoading">Enregistrement...</span>
          <span *ngIf="!isLoading">
            {{ editingWarehouseId ? 'Enregistrer les modifications' : 'Créer l’entrepôt' }}
          </span>
        </button>
      </div>
    </div>
  </div>
</div>
